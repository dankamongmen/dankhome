#!/bin/bash

OPTIONS="-alang en"

exithandle () {
	setterm -cursor on
	setterm -blank 15
	echo "restored terminal settings"
}

trap exithandle EXIT HUP INT QUIT || { echo "Couldn't register exit handler." >&2 ; exit 1 ; }

setterm -blank 0
setterm -cursor off

#set | grep ^DISPLAY= > /dev/null || OPTIONS="$OPTIONS -vo fbdev"

get_dimensions () {
	# "  dimensions:    1920x1200 pixels (554x346 millimeters)"
	if set | grep ^DISPLAY > /dev/null ; then
		DIM="`xdpyinfo | grep dimensions | cut -d: -f2 | cut -dp -f1`"
	else
		DIM=`fbset -i | grep ^mode | cut -d\" -f2 | cut -d\" -f1`
	fi
	XDIM=`echo $DIM | cut -dx -f1`
	YDIM=`echo $DIM | cut -dx -f2`
}

get_dimensions

case "`basename $0`" in
	mp)
		;;
	mpfs)
		OPTIONS="$OPTIONS -zoom -x $XDIM -y $YDIM"
		;;
	mpfsna)
		OPTIONS="$OPTIONS -zoom -x $XDIM -y $YDIM -nosound"
		;;
	mpna)
		OPTIONS="$OPTIONS -nosound"
		;;
	mpdvd)
		OPTIONS="$OPTIONS -aspect 16:9 -zoom -x $XDIM -y $YDIM"
	        OPTIONS="$OPTIONS -dvd-device /dev/dvd -slang en"
		echo mplayer $OPTIONS dvd://$1
		mplayer $OPTIONS dvd://$1
		shift
		;;
	*)
		echo "Unknown calling method: $0...sleeping for 10s"
		sleep 10
		;;
esac

for i in "$@" ; do
	echo mplayer $OPTIONS "$i"
	mplayer $OPTIONS "$i"
done
